---
layout: post
title: An open-source P4 switch with SAI support
date: 2015-06-17
author: P4.org
header-img: img/p4-background.png
---
<p><em>By Chaitanya “CK” Kodeboyina</em></p>
<p>First let me introduce myself. I am the head of software at Barefoot Networks where I lead a senior team of engineers with many years of experience building networking systems, software and chips.</p>
<p>Whether you build your own chips or use off-the-shelf merchant silicon, it can be frustrating to write software for fixed-function switch chips. You are limited by the set of capabilities baked into the silicon. You can't add new features, and you have little or no control over how the switch resources are allocated. This should improve over the next few years as P4-programmable switch chips become available allowing us to: (1) Define and customize how a switch processes packets, and (2) Auto-generate an API to interface the chip to the switch software.</p>
<p>To help move this vision along, my team recently open-sourced a compiler that lets you turn a P4 program into an executable soft switch. If you've not seen the compiler and tool-chain, you should check out the following GitHub repos: <a href="https://github.com/p4lang/p4c-behavioral">p4compiler</a> and <a href="https://github.com/p4lang/p4factory">p4factory</a>. With these tools you can write your own switch description in P4, then turn it into an executable soft switch.</p>
<p>The next thing we need is a collection of production-quality switch forwarding planes written in P4, for us all to share and build upon. As you probably know, real production switches are complicated (and proprietary) and it is hard to find out exactly what they do, even with an NDA. State-of-the-art switching chips today provide a lot of features like unicast and multicast forwarding, network virtualization and other tunneling technologies, policy enforcement and security features, traffic prioritization and monitoring features, and multi-chip fabric forwarding. We know from experience how complicated and time-consuming it is to craft a feature-rich switch forwarding plane.</p>
<p>We thought it would help the broader community of network developers and researchers if we open-source some realistic production switch designs in P4. You can use them as-is, or as a starting point for more advanced and customized switches, NICs, routers, load balancers, security appliances etc.</p>
<p>And so today my team is proud to release two open-source projects:</p>
<p>1) An Open &amp; Programmable Ethernet/IP Switch</p>
<p><em>switch.p4</em> is a P4 program expressing the forwarding plane of a switch, with features typical of an advanced Ethernet and IP switch. This specification can be compiled using the P4 compiler to create an executable switch. The tables in <em>switch.p4</em> can be programmed using low-level resource management APIs auto-generated by the compiler from the P4 program. For more details on how to compile and run <em>switch.p4</em>, check out the switch target in p4-factory - <a href="https://github.com/p4lang/p4factory/tree/master/targets/switch">switch</a>.</p>
<p>2) An Open implementation of Switch Abstraction Interface (SAI) on switch.p4</p>
<p><a href="http://azure.microsoft.com/blog/2015/03/10/microsoft-furthers-open-networking-specification/">SAI</a> is a new standardized API for switches, allowing the same software to program lots of different switch chips without any changes.  I am pleased to announce that <em>switch.p4</em> can be controlled via SAI using the open-source <em>switchsai</em> and <em>switchapi</em> libraries. We are publishing source code for both libraries, which means all layers of software from applications down to the data plane are open. For more details on <em>switchsai</em> and <em>switchapi</em> visit the following github repos: <a href="https://github.com/p4lang/switchsai">switchsai</a> and <a href="https://github.com/p4lang/switchapi">switchapi</a>.</p>
<p>The picture below shows the relationship between the different API layers. At the bottom is the software switch, compiled from <em>switch.p4</em>. The low-level resources are managed by the auto-generated API. The <em>switchsai</em> and <em>switchapi</em> libraries let applications program the tables in the soft switch using SAI.</p>
<pre><code>+-----+    +-----+   +-----+  +-----+
|App 1|    |App j|   |App n|  |App q|
|     |... |     |...|     |..|     | 
+-----+    +-----+   +-----+  +-----+
   |        |          |  |     |
+-----------------------+ |     |
|          SAI          | |     |
|(via switchsai/api lib)| |     |
+-----------------------+---------+
|      Resource Mgmt. API         |
| (auto-gen. from switch.p4)      |
+---------------------------------+
|        Soft Switch              |
|  (compiled from switch.p4)      |
+---------------------------------+</code></pre>
<p>With the release of <em>switch.p4</em> and the support for SAI, we hope to create a more open culture in networking, leading to more open-source code that is portable across switch chips. We encourage the networking community of vendors, operators, researchers and independent software engineers to build upon our code and push the boundaries of what is possible in the world of networking.</p>
<p>Stay tuned for more exciting things to come!</p>
<p>&nbsp;</p>
